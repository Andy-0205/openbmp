-- MySQL dump 10.13  Distrib 5.5.37, for debian-linux-gnu (x86_64)
--
-- Host: 127.0.0.1    Database: openBMP
-- ------------------------------------------------------
-- Server version	5.6.10

/*!40101 SET @OLD_CHARACTER_SET_CLIENT=@@CHARACTER_SET_CLIENT */;
/*!40101 SET @OLD_CHARACTER_SET_RESULTS=@@CHARACTER_SET_RESULTS */;
/*!40101 SET @OLD_COLLATION_CONNECTION=@@COLLATION_CONNECTION */;
/*!40101 SET NAMES utf8 */;
/*!40103 SET @OLD_TIME_ZONE=@@TIME_ZONE */;
/*!40103 SET TIME_ZONE='+00:00' */;
/*!40014 SET @OLD_UNIQUE_CHECKS=@@UNIQUE_CHECKS, UNIQUE_CHECKS=0 */;
/*!40014 SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0 */;
/*!40101 SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE='NO_AUTO_VALUE_ON_ZERO' */;
/*!40111 SET @OLD_SQL_NOTES=@@SQL_NOTES, SQL_NOTES=0 */;

--
-- Table structure for table `bgp_peers`
--

DROP TABLE IF EXISTS `bgp_peers`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `bgp_peers` (
  `hash_id` char(32) NOT NULL COMMENT 'peer hash ID is a hash of:\n\nrouter hash_id, peer_rd, peer_addr, and peer_bgp_id',
  `router_hash_id` char(32) NOT NULL,
  `peer_rd` varchar(32) NOT NULL COMMENT 'RD that this peer belongs to',
  `peer_addr_type` tinyint(3) unsigned NOT NULL COMMENT 'IP address type for peer:  \n\n1 = IPv4\n2 = IPv6',
  `peer_addr` varchar(40) NOT NULL,
  `name` varchar(200) DEFAULT NULL,
  `peer_bgp_id` varchar(15) NOT NULL,
  `peer_as` int(10) unsigned NOT NULL,
  `state` tinyint(4) NOT NULL DEFAULT '1',
  `isL3VPNpeer` tinyint(4) NOT NULL DEFAULT '0',
  `timestamp` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`hash_id`,`router_hash_id`),
  KEY `idx_addr` (`peer_addr`),
  KEY `idx_name` (`name`),
  KEY `idx_main` (`peer_rd`,`peer_addr`),
  KEY `idx_as` (`peer_as`)
) ENGINE=InnoDB DEFAULT CHARSET=latin1 ROW_FORMAT=DYNAMIC;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `path_attr_log`
--

DROP TABLE IF EXISTS `path_attr_log`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `path_attr_log` (
  `rib_hash_id` char(32) NOT NULL,
  `path_attr_hash_id` char(32) NOT NULL,
  `timestamp` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`rib_hash_id`,`path_attr_hash_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=DYNAMIC
/*!50100 PARTITION BY KEY (rib_hash_id)
PARTITIONS 64 */;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `path_attrs`
--

DROP TABLE IF EXISTS `path_attrs`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `path_attrs` (
  `hash_id` char(32) NOT NULL COMMENT 'Attribute hash ID is a hash of peer_hash_id along with the following fields:\n\nas_path, next_hop_v4, aggregator_v4, aggregator_v6, origin, med, local_pref',
  `peer_hash_id` char(32) NOT NULL,
  `origin` varchar(16) NOT NULL,
  `as_path` varchar(8192) NOT NULL,
  `as_length` int(8) unsigned DEFAULT NULL,
  `origin_as` int(10) unsigned DEFAULT NULL,
  `next_hop_v4` varchar(15) NOT NULL,
  `next_hop_v6` varchar(40) DEFAULT NULL,
  `med` int(10) unsigned DEFAULT NULL,
  `local_pref` int(10) unsigned DEFAULT NULL,
  `aggregator_v4` varchar(32) DEFAULT NULL,
  `aggregator_v6` varchar(64) DEFAULT NULL,
  `community_list` varchar(4096) DEFAULT NULL,
  `ext_community_list` varchar(2048) DEFAULT NULL,
  `cluster_list` varchar(2048) DEFAULT NULL,
  `isAtomicAgg` tinyint(4) DEFAULT '0',
  `timestamp` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  `originator_id` varchar(15) DEFAULT NULL,
  PRIMARY KEY (`hash_id`,`peer_hash_id`),
  KEY `idx_peer_hash_id` (`peer_hash_id`),
  KEY `idx_origin_as` (`origin_as`),
  KEY `idx_as_length` (`as_length`)
) ENGINE=InnoDB DEFAULT CHARSET=latin1 ROW_FORMAT=DYNAMIC COMMENT='Path attribute table'
/*!50100 PARTITION BY KEY (peer_hash_id)
PARTITIONS 64 */;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `peer_down_events`
--

DROP TABLE IF EXISTS `peer_down_events`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `peer_down_events` (
  `id` bigint(20) NOT NULL AUTO_INCREMENT,
  `peer_hash_id` char(32) NOT NULL,
  `bmp_reason` varchar(64) DEFAULT NULL,
  `bgp_err_code` int(10) unsigned DEFAULT NULL,
  `bgp_err_subcode` int(10) unsigned DEFAULT NULL,
  `error_text` varchar(255) DEFAULT NULL,
  `timestamp` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`,`peer_hash_id`),
  KEY `idx_error` (`peer_hash_id`,`bmp_reason`),
  KEY `idx_bgp_errors` (`bgp_err_code`,`bgp_err_subcode`)
) ENGINE=InnoDB AUTO_INCREMENT=8 DEFAULT CHARSET=latin1 ROW_FORMAT=DYNAMIC;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Temporary table structure for view `prefix_aspath`
--

DROP TABLE IF EXISTS `prefix_aspath`;
/*!50001 DROP VIEW IF EXISTS `prefix_aspath`*/;
SET @saved_cs_client     = @@character_set_client;
SET character_set_client = utf8;
/*!50001 CREATE TABLE `prefix_aspath` (
  `RouterName` tinyint NOT NULL,
  `PeerName` tinyint NOT NULL,
  `Prefix` tinyint NOT NULL,
  `PrefixLen` tinyint NOT NULL,
  `Origin` tinyint NOT NULL,
  `AS_Path` tinyint NOT NULL,
  `NH` tinyint NOT NULL
) ENGINE=MyISAM */;
SET character_set_client = @saved_cs_client;

--
-- Table structure for table `rib`
--

DROP TABLE IF EXISTS `rib`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `rib` (
  `hash_id` char(32) NOT NULL COMMENT 'RIB hash is an MD5 hash of the router src_addr, bgp_peers hash, attr hash, and prefix',
  `path_attr_hash_id` char(32) NOT NULL,
  `peer_hash_id` char(32) NOT NULL,
  `prefix` varchar(40) NOT NULL,
  `prefix_len` int(10) unsigned NOT NULL,
  `state` tinyint(4) DEFAULT '1',
  `timestamp` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`hash_id`,`peer_hash_id`),
  KEY `idx_peer_id` (`peer_hash_id`),
  KEY `idx_path_id` (`path_attr_hash_id`),
  KEY `idx_prefix` (`prefix`),
  KEY `idx_active` (`state`),
  KEY `idx_prefix_len` (`prefix_len`)
) ENGINE=InnoDB DEFAULT CHARSET=latin1 ROW_FORMAT=DYNAMIC
/*!50100 PARTITION BY KEY (peer_hash_id)
PARTITIONS 64 */;
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 trigger pre_update BEFORE UPDATE on rib 
  for each ROW  
      if (old.path_attr_hash_id != new.path_attr_hash_id AND new.state != 0) THEN 
          INSERT IGNORE INTO path_attr_log (rib_hash_id,path_attr_hash_id,timestamp) VALUES (old.hash_id,old.path_attr_hash_id,new.timestamp); 
      END IF */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `routers`
--

DROP TABLE IF EXISTS `routers`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `routers` (
  `hash_id` char(32) NOT NULL COMMENT 'Router ID is the source address as numeric value (either 32 or 128bits)',
  `name` varchar(200) NOT NULL,
  `ip_address` varchar(40) NOT NULL,
  `ip_address_type` tinyint(3) unsigned NOT NULL DEFAULT '1' COMMENT 'IP Address Type:\n   1 = IPv4\n   2 = IPv6',
  `router_AS` int(10) unsigned DEFAULT NULL,
  `timestamp` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`hash_id`),
  KEY `idx_name` (`name`),
  KEY `idx_ip_type` (`ip_address_type`,`ip_address`),
  KEY `idx_ip` (`ip_address`)
) ENGINE=InnoDB DEFAULT CHARSET=latin1 ROW_FORMAT=DYNAMIC COMMENT='Routers table defines and contains the list of routers sendi';
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Temporary table structure for view `routes`
--

DROP TABLE IF EXISTS `routes`;
/*!50001 DROP VIEW IF EXISTS `routes`*/;
SET @saved_cs_client     = @@character_set_client;
SET character_set_client = utf8;
/*!50001 CREATE TABLE `routes` (
  `RouterName` tinyint NOT NULL,
  `PeerName` tinyint NOT NULL,
  `Prefix` tinyint NOT NULL,
  `PrefixLen` tinyint NOT NULL,
  `Origin` tinyint NOT NULL,
  `Origin_AS` tinyint NOT NULL,
  `MED` tinyint NOT NULL,
  `LocalPref` tinyint NOT NULL,
  `NH` tinyint NOT NULL,
  `AS_Path` tinyint NOT NULL,
  `ASPath_Len` tinyint NOT NULL,
  `Communities` tinyint NOT NULL,
  `ClusterList` tinyint NOT NULL,
  `Aggregator` tinyint NOT NULL,
  `PeerAddress` tinyint NOT NULL,
  `PeerASN` tinyint NOT NULL,
  `LastModified` tinyint NOT NULL
) ENGINE=MyISAM */;
SET character_set_client = @saved_cs_client;

--
-- Temporary table structure for view `routes_history`
--

DROP TABLE IF EXISTS `routes_history`;
/*!50001 DROP VIEW IF EXISTS `routes_history`*/;
SET @saved_cs_client     = @@character_set_client;
SET character_set_client = utf8;
/*!50001 CREATE TABLE `routes_history` (
  `RouterName` tinyint NOT NULL,
  `PeerName` tinyint NOT NULL,
  `Prefix` tinyint NOT NULL,
  `PrefixLen` tinyint NOT NULL,
  `Origin` tinyint NOT NULL,
  `Origin_AS` tinyint NOT NULL,
  `MED` tinyint NOT NULL,
  `LocalPref` tinyint NOT NULL,
  `NH` tinyint NOT NULL,
  `AS_Path` tinyint NOT NULL,
  `ASPath_Len` tinyint NOT NULL,
  `Communities` tinyint NOT NULL,
  `ClusterList` tinyint NOT NULL,
  `Aggregator` tinyint NOT NULL,
  `PeerAddress` tinyint NOT NULL,
  `PeerASN` tinyint NOT NULL,
  `LastModified` tinyint NOT NULL
) ENGINE=MyISAM */;
SET character_set_client = @saved_cs_client;

--
-- Table structure for table `stat_reports`
--

DROP TABLE IF EXISTS `stat_reports`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `stat_reports` (
  `id` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
  `peer_hash_id` char(32) NOT NULL,
  `prefixes_rejected` bigint(20) unsigned DEFAULT NULL,
  `known_dup_prefixes` bigint(20) unsigned DEFAULT NULL,
  `known_dup_withdraws` bigint(20) unsigned DEFAULT NULL,
  `updates_invalid_by_cluster_list` bigint(20) unsigned DEFAULT NULL,
  `updates_invalid_by_as_path_loop` bigint(20) unsigned DEFAULT NULL,
  `timestamp` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`,`peer_hash_id`)
) ENGINE=InnoDB AUTO_INCREMENT=7651 DEFAULT CHARSET=latin1 ROW_FORMAT=DYNAMIC;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `withdrawn_log`
--

DROP TABLE IF EXISTS `withdrawn_log`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `withdrawn_log` (
  `id` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
  `peer_hash_id` char(32) NOT NULL,
  `prefix` varchar(40) NOT NULL,
  `prefix_len` int(10) unsigned NOT NULL,
  `timestamp` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`,`peer_hash_id`),
  KEY `idx_prefix` (`prefix`,`prefix_len`)
) ENGINE=InnoDB AUTO_INCREMENT=1179194 DEFAULT CHARSET=latin1 ROW_FORMAT=DYNAMIC
/*!50100 PARTITION BY KEY (peer_hash_id)
PARTITIONS 64 */;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Final view structure for view `prefix_aspath`
--

/*!50001 DROP TABLE IF EXISTS `prefix_aspath`*/;
/*!50001 DROP VIEW IF EXISTS `prefix_aspath`*/;
/*!50001 SET @saved_cs_client          = @@character_set_client */;
/*!50001 SET @saved_cs_results         = @@character_set_results */;
/*!50001 SET @saved_col_connection     = @@collation_connection */;
/*!50001 SET character_set_client      = utf8 */;
/*!50001 SET character_set_results     = utf8 */;
/*!50001 SET collation_connection      = utf8_general_ci */;
/*!50001 CREATE ALGORITHM=UNDEFINED */
/*!50013 DEFINER=`root`@`localhost` SQL SECURITY DEFINER */
/*!50001 VIEW `prefix_aspath` AS select `rtr`.`name` AS `RouterName`,`p`.`name` AS `PeerName`,`r`.`prefix` AS `Prefix`,`r`.`prefix_len` AS `PrefixLen`,`path`.`origin` AS `Origin`,trim(`path`.`as_path`) AS `AS_Path`,`path`.`next_hop_v4` AS `NH` from (`bgp_peers` `p` straight_join ((`rib` `r` straight_join `routers` `rtr`) straight_join `path_attrs` `path`) on(((`r`.`peer_hash_id` = `p`.`hash_id`) and (`r`.`path_attr_hash_id` = `path`.`hash_id`) and (`p`.`router_hash_id` = `rtr`.`hash_id`)))) */;
/*!50001 SET character_set_client      = @saved_cs_client */;
/*!50001 SET character_set_results     = @saved_cs_results */;
/*!50001 SET collation_connection      = @saved_col_connection */;

--
-- Final view structure for view `routes`
--

/*!50001 DROP TABLE IF EXISTS `routes`*/;
/*!50001 DROP VIEW IF EXISTS `routes`*/;
/*!50001 SET @saved_cs_client          = @@character_set_client */;
/*!50001 SET @saved_cs_results         = @@character_set_results */;
/*!50001 SET @saved_col_connection     = @@collation_connection */;
/*!50001 SET character_set_client      = utf8 */;
/*!50001 SET character_set_results     = utf8 */;
/*!50001 SET collation_connection      = utf8_general_ci */;
/*!50001 CREATE ALGORITHM=UNDEFINED */
/*!50013 DEFINER=`root`@`localhost` SQL SECURITY DEFINER */
/*!50001 VIEW `routes` AS select `rtr`.`name` AS `RouterName`,`p`.`name` AS `PeerName`,`r`.`prefix` AS `Prefix`,`r`.`prefix_len` AS `PrefixLen`,`path`.`origin` AS `Origin`,`path`.`origin_as` AS `Origin_AS`,`path`.`med` AS `MED`,`path`.`local_pref` AS `LocalPref`,if(isnull(`path`.`next_hop_v4`),`path`.`next_hop_v6`,`path`.`next_hop_v4`) AS `NH`,`path`.`as_path` AS `AS_Path`,`path`.`as_length` AS `ASPath_Len`,`path`.`community_list` AS `Communities`,`path`.`cluster_list` AS `ClusterList`,if(isnull(`path`.`aggregator_v6`),`path`.`aggregator_v4`,`path`.`aggregator_v6`) AS `Aggregator`,`p`.`peer_addr` AS `PeerAddress`,`p`.`peer_as` AS `PeerASN`,`r`.`timestamp` AS `LastModified` from (((`bgp_peers` `p` join `rib` `r`) join `path_attrs` `path`) join `routers` `rtr` on(((`p`.`hash_id` = `path`.`peer_hash_id`) and (`p`.`hash_id` = `r`.`peer_hash_id`) and (`r`.`path_attr_hash_id` = `path`.`hash_id`) and (`p`.`router_hash_id` = `rtr`.`hash_id`)))) */;
/*!50001 SET character_set_client      = @saved_cs_client */;
/*!50001 SET character_set_results     = @saved_cs_results */;
/*!50001 SET collation_connection      = @saved_col_connection */;

--
-- Final view structure for view `routes_history`
--

/*!50001 DROP TABLE IF EXISTS `routes_history`*/;
/*!50001 DROP VIEW IF EXISTS `routes_history`*/;
/*!50001 SET @saved_cs_client          = @@character_set_client */;
/*!50001 SET @saved_cs_results         = @@character_set_results */;
/*!50001 SET @saved_col_connection     = @@collation_connection */;
/*!50001 SET character_set_client      = utf8 */;
/*!50001 SET character_set_results     = utf8 */;
/*!50001 SET collation_connection      = utf8_general_ci */;
/*!50001 CREATE ALGORITHM=UNDEFINED */
/*!50013 DEFINER=`openbmp`@`%` SQL SECURITY DEFINER */
/*!50001 VIEW `routes_history` AS select `rtr`.`name` AS `RouterName`,`p`.`name` AS `PeerName`,`r`.`prefix` AS `Prefix`,`r`.`prefix_len` AS `PrefixLen`,`path`.`origin` AS `Origin`,`path`.`origin_as` AS `Origin_AS`,`path`.`med` AS `MED`,`path`.`local_pref` AS `LocalPref`,if(isnull(`path`.`next_hop_v4`),`path`.`next_hop_v6`,`path`.`next_hop_v4`) AS `NH`,`path`.`as_path` AS `AS_Path`,`path`.`as_length` AS `ASPath_Len`,`path`.`community_list` AS `Communities`,`path`.`cluster_list` AS `ClusterList`,if(isnull(`path`.`aggregator_v6`),`path`.`aggregator_v4`,`path`.`aggregator_v6`) AS `Aggregator`,`p`.`peer_addr` AS `PeerAddress`,`p`.`peer_as` AS `PeerASN`,if((convert(`r`.`path_attr_hash_id` using utf8) = `pathlog`.`path_attr_hash_id`),`r`.`timestamp`,`path`.`timestamp`) AS `LastModified` from ((((`rib` `r` left join `path_attr_log` `pathlog` on((convert(`r`.`hash_id` using utf8) = `pathlog`.`rib_hash_id`))) join `bgp_peers` `p`) join `routers` `rtr` on(((`r`.`peer_hash_id` = `p`.`hash_id`) and (`p`.`router_hash_id` = `rtr`.`hash_id`)))) join `path_attrs` `path` on(((isnull(`pathlog`.`path_attr_hash_id`) and (`r`.`path_attr_hash_id` = `path`.`hash_id`)) or ((`pathlog`.`path_attr_hash_id` = convert(`path`.`hash_id` using utf8)) and (`pathlog`.`rib_hash_id` = convert(`r`.`hash_id` using utf8)))))) */;
/*!50001 SET character_set_client      = @saved_cs_client */;
/*!50001 SET character_set_results     = @saved_cs_results */;
/*!50001 SET collation_connection      = @saved_col_connection */;
/*!40103 SET TIME_ZONE=@OLD_TIME_ZONE */;

/*!40101 SET SQL_MODE=@OLD_SQL_MODE */;
/*!40014 SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS */;
/*!40014 SET UNIQUE_CHECKS=@OLD_UNIQUE_CHECKS */;
/*!40101 SET CHARACTER_SET_CLIENT=@OLD_CHARACTER_SET_CLIENT */;
/*!40101 SET CHARACTER_SET_RESULTS=@OLD_CHARACTER_SET_RESULTS */;
/*!40101 SET COLLATION_CONNECTION=@OLD_COLLATION_CONNECTION */;
/*!40111 SET SQL_NOTES=@OLD_SQL_NOTES */;

-- Dump completed on 2014-06-21  9:41:36
